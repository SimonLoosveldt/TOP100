@page "/login"
@using TopHundred.Views.Services
@using TopHundred.Controllers.Services
@using TopHundred.Controllers.Exceptions
@using TopHundred.Controllers
@inject IUserService userService
@inject IErrorService errorService
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime

<div class="main">
    <div class="middleContent">

        <div class="top_middleContent">
            <h2>@PageTitle</h2>
        </div>

        <div class="content">
            <MatCard>
                <p>
                    <MatTextField @bind-Value="@FirstName" Label="Voornaam" Outlined="true"></MatTextField>
                </p>
                <p>
                    <MatTextField @bind-Value="@LastName" Label="Achternaam" Outlined="true"></MatTextField>
                </p>
            </MatCard>
         
            <span>
                <input type="button" id="login_button" @bind="LoginButtonLabel" @onclick="LoginPressed" />
            </span>
        </div>
    </div>
</div>

@code {

    // Private
    private UserController userController { get; set; }

    // Properties
    public string PageTitle { get; set; } = "AANMELDEN";
    public string LoginButtonLabel { get; set; } = "LOGIN";
    public string FirstName { get; set; } = string.Empty;
    public string LastName { get; set; } = string.Empty;

    // Protected
    protected override void OnInitialized()
    {
        userController = new UserController();
    }

    // Private
    private async void LoginPressed()
    {
        if (!InputFilledCheck())
        {
            await LaunchPopUp("Please fill in all fields...");
        }
        else
        {

            try
            {
                userService.Login(userController.GetUserByName(FirstName, LastName));
                Redirect();
            }
            catch (UserNotFoundException)
            {
                await LaunchPopUp("Unrecognized user...");
            }
        }
    }

    private async Task LaunchPopUp(string message)
    {
        // https://blazor-university.com/javascript-interop/
        await JSRuntime.InvokeVoidAsync("alert", message);
    }

    private bool InputFilledCheck()
    {
        return string.IsNullOrEmpty(FirstName) || string.IsNullOrEmpty(LastName) ? false : true;
    }

    private void Redirect()
    {
        NavigationManager.NavigateTo("/", true);
    }
}